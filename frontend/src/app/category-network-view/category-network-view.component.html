<div
  *ngIf="isDataLoaded"
  style="position: relative; width: 100%; height: 100%;"
  class="mat-typography"
>
  <svg
    *ngIf="category"
    [attr.viewBox]="viewBoxDimensions()"
    xmlns="http://www.w3.org/2000/svg"
    style="position: absolute; left: 0; top: 0; right: 0; bottom: 0;"
  >
    <defs>
      <linearGradient
        id="linear"
        x1="0%"
        y1="0%"
        x2="0%"
        y2="100%"
      >
        <stop
          offset="0%"
          [ngStyle]="{'stop-color': categoryColor(category.color, 0)}"
        />
        <stop
          offset="100%"
          [ngStyle]="{'stop-color': categoryColor(category.color, 1)}"
        />
      </linearGradient>
      <linearGradient
        *ngFor="let node of allCategories"
        [attr.id]="'linear-' + node.id"
        x1="0%"
        y1="0%"
        x2="0%"
        y2="100%"
      >
        <stop
          offset="0%"
          [ngStyle]="{'stop-color': categoryColor(node.color, 0)}"
        />
        <stop
          offset="100%"
          [ngStyle]="{'stop-color': categoryColor(node.color, 1)}"
        />
      </linearGradient>
    </defs>

    <!-- TOP-LEVEL NODES -->
    <g
      [attr.transform]="translateTo('top-right')"
      class="top-level"
    >
      <g
        app-network-view-node
        *ngFor="let node of allCategories; let i = index"
        [attr.transform]="translateByIndex(i)"
        (click)="goCategory(node)"
        [ngStyle]="{'opacity': isSelectedCategory(node) ? 0.1 : 1}"
        [category]="node"
        [options]="{
          relationship: 'root',
          px: 0,
          py: 0,
          x: 0,
          y: 0,
          radius: navRadius,
          angle: 0,
          titleHeight: parentTitleHeight
        }"
      />
    </g>

    <g [attr.transform]="translateTo('origin')">

      <!-- PARENT & CHILD NODES -->
      <g
        *ngFor="let node of categoryNodes(category); let i = index"
        [attr.transform]="rotateChild(i, categoryNodes(category).length)"
        (click)="goCategory(node)"
        (mouseover)="node.hover=true"
        (mouseout)="node.hover=false"
      >
        <!-- LINE CONNECTING TO CHILD NODE / PARENT NODE -->
        <line
          x1="0"
          y1="0"
          [attr.transform]="node.hover ? 'scale(1.1)' : 'scale(1)'"
          [attr.x2]="nodeLineLength(node, i)"
          y2="0"
          [attr.stroke]="category.color"
        />
        <g
          class="node"
          [attr.transform]="unrotateChild(node, i, categoryNodes(category).length)"
        >

          <!-- GRANDCHILD NODES -->
          <g [attr.transform]="translateTo('node', node, i)">
            <g
              app-network-view-node
              *ngFor="let nodeChild of node.children; let j = index"
              [attr.transform]="rotateChild(j, node.children.length)"
              [category]="nodeChild"
              [numTotal]="node.children.length"
              [options]="{
                relationship: 'grandchild',
                px: 0,
                py: 0,
                x: nodeRadius + nodeChildRadius * 2,
                y: 0,
                radius: nodeChildRadius,
                angle: rotateChildDegrees(j, node.children.length)
              }"
            />
          </g>

          <g *ngIf="isParentNode(node) && (node.level === 0)">

            <!-- SIBLING NODES -->
            <g
              *ngFor="let sibling of siblings(node); let k = index"
              class="sibling"
              [attr.transform]="translateTo('node', node, i) +' '+ rotateChild(k, siblings(node).length, 'siblings')"
            >
              <g
                app-network-view-node
                *ngIf="sibling.id !== category.id"
                [category]="sibling"
                [numTotal]="siblings(node).length"
                [options]="{
                  relationship: 'sibling',
                  x: nodeRadius * 2,
                  y: 0,
                  radius: nodeRadius/2,
                  angle: rotateChildDegrees(k, siblings(node).length, -2)
                }"
              />
            </g>

            <!-- PARENT NODE -->
            <g
              app-network-view-node
              [category]="node"
              [options]="{
                relationship: 'parent',
                x: nodeLineLength(node, i),
                y: 0,
                radius: nodeRadius,
                angle: 0,
                titleHeight: parentTitleHeight
              }"
            />
          </g>

          <!-- CHILD NODE -->
          <g
            app-network-view-node
            [category]="node"
            [options]="{
              relationship: 'child',
              x: nodeLineLength(node, i) + nodeRadius,
              y: 0,
              radius: nodeRadius,
              angle: 0,
              titleHeight: parentTitleHeight
            }"
          />
        </g>
      </g>

      <!-- SELF -->
      <g
        app-network-view-node
        [category]="category"
        [options]="{
          relationship: 'self',
          x: 0,
          y: 0,
          radius: selfRadius,
          angle: 0,
          titleHeight: selfTitleHeight
        }"
      />
    </g>
  </svg>
</div>